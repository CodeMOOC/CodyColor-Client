(function(){var e,t,n,r,i={}.hasOwnProperty,o=[].slice;e={LF:"\n",NULL:"\0"},n=function(){var t;function n(e,t,n,r){this.command=e,this.headers=null!=t?t:{},this.body=null!=n?n:"",this.escapeHeaderValues=null!=r&&r}return n.prototype.toString=function(){var t,r,o,s,c;for(r in t=[this.command],(s=!1===this.headers["content-length"])&&delete this.headers["content-length"],o=this.headers)i.call(o,r)&&(c=o[r],this.escapeHeaderValues&&"CONNECT"!==this.command&&"CONNECTED"!==this.command?t.push(r+":"+n.frEscape(c)):t.push(r+":"+c));return this.body&&!s&&t.push("content-length:"+n.sizeOfUTF8(this.body)),t.push(e.LF+this.body),t.join(e.LF)},n.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},t=function(t,r){var i,o,s,c,a,u,h,l,f,p,d,g,b,m,y,v,_,S;for(null==r&&(r=!1),c=t.search(RegExp(""+e.LF+e.LF)),s=(a=t.substring(0,c).split(e.LF)).shift(),u={},S=function(e){return e.replace(/^\s+|\s+$/g,"")},f=0,g=(m=a.reverse()).length;f<g;f++)l=(b=m[f]).indexOf(":"),u[S(b.substring(0,l))]=r&&"CONNECT"!==s&&"CONNECTED"!==s?n.frUnEscape(S(b.substring(l+1))):S(b.substring(l+1));if(i="",_=c+2,u["content-length"])d=parseInt(u["content-length"]),i=(""+t).substring(_,_+d);else for(o=null,h=p=y=_,v=t.length;(y<=v?p<v:p>v)&&(o=t.charAt(h))!==e.NULL;h=y<=v?++p:--p)i+=o;return new n(s,u,i,r)},n.unmarshall=function(n,r){var i,o,s,c;return null==r&&(r=!1),o=n.split(RegExp(""+e.NULL+e.LF+"*")),(c={frames:[],partial:""}).frames=function(){var e,n,s,c;for(c=[],e=0,n=(s=o.slice(0,-1)).length;e<n;e++)i=s[e],c.push(t(i,r));return c}(),(s=o.slice(-1)[0])===e.LF||-1!==s.search(RegExp(""+e.NULL+e.LF+"*$"))?c.frames.push(t(s,r)):c.partial=s,c},n.marshall=function(t,r,i,o){return new n(t,r,i,o).toString()+e.NULL},n.frEscape=function(e){return(""+e).replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")},n.frUnEscape=function(e){return(""+e).replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\c/g,":").replace(/\\\\/g,"\\")},n}(),t=function(){var t;function i(e){this.ws_fn=function(){var t;return(t=e()).binaryType="arraybuffer",t},this.reconnect_delay=0,this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}return i.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},t=function(){return Date.now?Date.now():(new Date).valueOf},i.prototype._transmit=function(e,t,r){var i;for(i=n.marshall(e,t,r,this.escapeHeaderValues),"function"==typeof this.debug&&this.debug(">>> "+i);;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+i.length)}},i.prototype._setupHeartbeat=function(n){var i,o,s,c,a,u,h;if((i=n.version)===r.VERSIONS.V1_1||i===r.VERSIONS.V1_2)return c=(o=function(){var e,t,r,i;for(i=[],e=0,t=(r=n["heart-beat"].split(",")).length;e<t;e++)u=r[e],i.push(parseInt(u));return i}())[0],s=o[1],0!==this.heartbeat.outgoing&&0!==s&&(a=Math.max(this.heartbeat.outgoing,s),"function"==typeof this.debug&&this.debug("send PING every "+a+"ms"),this.pinger=r.setInterval(a,(h=this,function(){return h.ws.send(e.LF),"function"==typeof h.debug?h.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==c?(a=Math.max(this.heartbeat.incoming,c),"function"==typeof this.debug&&this.debug("check PONG every "+a+"ms"),this.ponger=r.setInterval(a,function(e){return function(){var n;if((n=t()-e.serverActivity)>2*a)return"function"==typeof e.debug&&e.debug("did not receive server activity for the last "+n+"ms"),e.ws.close()}}(this))):void 0},i.prototype._parseConnect=function(){var e,t,n,r,i;if(i={},(e=1<=arguments.length?o.call(arguments,0):[]).length<2)throw"Connect requires at least 2 arguments";if("function"==typeof e[1])i=e[0],n=e[1],r=e[2],t=e[3];else switch(e.length){case 6:i.login=e[0],i.passcode=e[1],n=e[2],r=e[3],t=e[4],i.host=e[5];break;default:i.login=e[0],i.passcode=e[1],n=e[2],r=e[3],t=e[4]}return[i,n,r,t]},i.prototype.connect=function(){var e,t;return e=1<=arguments.length?o.call(arguments,0):[],this.escapeHeaderValues=!1,t=this._parseConnect.apply(this,e),this.headers=t[0],this.connectCallback=t[1],this.errorCallback=t[2],this.closeEventCallback=t[3],this._active=!0,this._connect()},i.prototype._connect=function(){var i,o,s,c,a;if(c=this.headers,s=this.errorCallback,o=this.closeEventCallback,this._active)return"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws=this.ws_fn(),i=function(e){var t,n,r,i,o,s;for(s="",o=e.length,i=0;i<o;)switch((t=e[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(t);break;case 12:case 13:n=e[i++],s+=String.fromCharCode((31&t)<<6|63&n);break;case 14:n=e[i++],r=e[i++],s+=String.fromCharCode((15&t)<<12|(63&n)<<6|(63&r)<<0)}return s},this.ws.onmessage=(a=this,function(o){var c,u,h,l,f,p,d,g,b,m,y;if(h="undefined"!=typeof ArrayBuffer&&o.data instanceof ArrayBuffer?(c=new Uint8Array(o.data),"function"==typeof a.debug&&a.debug("--- got data length: "+c.length),i(c)):o.data,a.serverActivity=t(),h!==e.LF)for("function"==typeof a.debug&&a.debug("<<< "+h),y=n.unmarshall(a.partialData+h,a.escapeHeaderValues),a.partialData=y.partial,f=0,p=(b=y.frames).length;f<p;f++)switch((l=b[f]).command){case"CONNECTED":if("function"==typeof a.debug&&a.debug("connected to server "+l.headers.server),a.connected=!0,a.version=l.headers.version,a.version===r.VERSIONS.V1_2&&(a.escapeHeaderValues=!0),!a._active)return void a.disconnect();a._setupHeartbeat(l.headers),"function"==typeof a.connectCallback&&a.connectCallback(l);break;case"MESSAGE":m=l.headers.subscription,(g=a.subscriptions[m]||a.onreceive)?(u=a,d=a.version===r.VERSIONS.V1_2?l.headers.ack:l.headers["message-id"],l.ack=function(e){return null==e&&(e={}),u.ack(d,m,e)},l.nack=function(e){return null==e&&(e={}),u.nack(d,m,e)},g(l)):"function"==typeof a.debug&&a.debug("Unhandled received MESSAGE: "+l);break;case"RECEIPT":l.headers["receipt-id"]===a.closeReceipt?(a.ws.onclose=null,a.ws.close(),a._cleanUp(),"function"==typeof a._disconnectCallback&&a._disconnectCallback()):"function"==typeof a.onreceipt&&a.onreceipt(l);break;case"ERROR":"function"==typeof s&&s(l);break;default:"function"==typeof a.debug&&a.debug("Unhandled frame: "+l)}else"function"==typeof a.debug&&a.debug("<<< PONG")}),this.ws.onclose=function(e){return function(t){var n;return n="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(n),"function"==typeof o&&o(t),e._cleanUp(),"function"==typeof s&&s("connectionLost"),e._schedule_reconnect()}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),c["accept-version"]=r.VERSIONS.supportedVersions(),c["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",c)}}(this);this.debug("Client has been marked inactive, will not attempt to connect")},i.prototype._schedule_reconnect=function(){if(this.reconnect_delay>0)return"function"==typeof this.debug&&this.debug("STOMP: scheduling reconnection in "+this.reconnect_delay+"ms"),this._reconnector=setTimeout((e=this,function(){return e.connected?"function"==typeof e.debug?e.debug("STOMP: already connected"):void 0:("function"==typeof e.debug&&e.debug("STOMP: attempting to reconnect"),e._connect())}),this.reconnect_delay);var e},i.prototype.disconnect=function(e,t){var n;if(null==t&&(t={}),this._disconnectCallback=e,this._active=!1,this.connected){t.receipt||(t.receipt="close-"+this.counter++),this.closeReceipt=t.receipt;try{return this._transmit("DISCONNECT",t)}catch(e){return n=e,"function"==typeof this.debug?this.debug("Ignoring error during disconnect",n):void 0}}},i.prototype._cleanUp=function(){if(this._reconnector&&clearTimeout(this._reconnector),this.connected=!1,this.subscriptions={},this.partial="",this.pinger&&r.clearInterval(this.pinger),this.ponger)return r.clearInterval(this.ponger)},i.prototype.send=function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)},i.prototype.subscribe=function(e,t,n){var r;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),r=this,{id:n.id,unsubscribe:function(e){return r.unsubscribe(n.id,e)}}},i.prototype.unsubscribe=function(e,t){return null==t&&(t={}),delete this.subscriptions[e],t.id=e,this._transmit("UNSUBSCRIBE",t)},i.prototype.begin=function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}},i.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},i.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},i.prototype.ack=function(e,t,n){return null==n&&(n={}),this.version===r.VERSIONS.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)},i.prototype.nack=function(e,t,n){return null==n&&(n={}),this.version===r.VERSIONS.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)},i}(),(r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.2,1.1,1.0"}},client:function(e,n){return null==n&&(n=["v10.stomp","v11.stomp","v12.stomp"]),new t(function(){return new(r.WebSocketClass||WebSocket)(e,n)})},over:function(e){return new t("function"==typeof e?e:function(){return e})},Frame:n}).setInterval=function(e,t){return setInterval(t,e)},r.clearInterval=function(e){return clearInterval(e)},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=r),"undefined"!=typeof window&&null!==window?window.Stomp=r:exports||(self.Stomp=r)}).call(this);